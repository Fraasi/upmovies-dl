#!/usr/bin/env node
var Rt=Object.defineProperty;var O=(t,e)=>{for(var n in e)Rt(t,n,{get:e[n],enumerable:!0})};import jn from"node:os";import On from"node:fs";import Ln from"node:url";import It from"node:path";import{spawnSync as ot}from"node:child_process";import*as zt from"node:readline/promises";var Bt={xml:!1,decodeEntities:!0},U=Bt,ft={_useHtmlParser2:!0,xmlMode:!0};function T(t){return t?.xml?typeof t.xml=="boolean"?ft:{...ft,...t.xml}:t??void 0}var v={};O(v,{contains:()=>Z,html:()=>ut,merge:()=>Jt,parseHTML:()=>Zt,root:()=>Ht,text:()=>A,xml:()=>ht});import{textContent as Ft}from"domutils";function lt(t,e,n){return t?t(e??t._root.children,null,void 0,n).toString():""}function Wt(t,e){return!e&&typeof t=="object"&&t!=null&&!("length"in t)&&!("type"in t)}function ut(t,e){let n=Wt(t)?(e=t,void 0):t,r={...U,...this===null||this===void 0?void 0:this._options,...T(e??{})};return lt(this,n,r)}function ht(t){let e={...this._options,xmlMode:!0};return lt(this,t,e)}function A(t){let e=t||(this?this.root():[]),n="";for(let r=0;r<e.length;r++)n+=Ft(e[r]);return n}function Zt(t,e,n=typeof e=="boolean"?e:!1){if(!t||typeof t!="string")return null;typeof e=="boolean"&&(n=e);let r=this.load(t,U,!1);return n||r("script").remove(),r.root()[0].children.slice()}function Ht(){return this(this._root)}function Z(t,e){if(e===t)return!1;let n=e;for(;n&&n!==n.parent;)if(n=n.parent,n===t)return!0;return!1}function Jt(t,e){if(!at(t)||!at(e))return;let n=t.length,r=+e.length;for(let i=0;i<r;i++)t[n++]=e[i];return t.length=n,t}function at(t){if(Array.isArray(t))return!0;if(typeof t!="object"||!Object.prototype.hasOwnProperty.call(t,"length")||typeof t.length!="number"||t.length<0)return!1;for(let e=0;e<t.length;e++)if(!(e in t))return!1;return!0}var G={};O(G,{addClass:()=>At,attr:()=>Xt,data:()=>te,hasClass:()=>re,prop:()=>Vt,removeAttr:()=>ne,removeClass:()=>vt,toggleClass:()=>kt,val:()=>ee});import{cloneNode as pt,Document as Yt}from"domhandler";import{isTag as u}from"domhandler";function g(t){return t.cheerio!=null}function dt(t){return t.replace(/[_.-](\w|$)/g,(e,n)=>n.toUpperCase())}function mt(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()}function h(t,e){let n=t.length;for(let r=0;r<n;r++)e(t[r],r);return t}function q(t){let e="length"in t?Array.prototype.map.call(t,r=>pt(r,!0)):[pt(t,!0)],n=new Yt(e);return e.forEach(r=>{r.parent=n}),e}var j;(function(t){t[t.LowerA=97]="LowerA",t[t.LowerZ=122]="LowerZ",t[t.UpperA=65]="UpperA",t[t.UpperZ=90]="UpperZ",t[t.Exclamation=33]="Exclamation"})(j||(j={}));function D(t){let e=t.indexOf("<");if(e<0||e>t.length-3)return!1;let n=t.charCodeAt(e+1);return(n>=j.LowerA&&n<=j.LowerZ||n>=j.UpperA&&n<=j.UpperZ||n===j.Exclamation)&&t.includes(">",e+2)}import{innerText as Gt,textContent as Kt}from"domutils";var L=Object.prototype.hasOwnProperty,C=/\s+/,H="data-",xt={null:null,true:!0,false:!1},Y=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Qt=/^{[^]*}$|^\[[^]*]$/;function R(t,e,n){var r;if(!(!t||!u(t))){if((r=t.attribs)!==null&&r!==void 0||(t.attribs={}),!e)return t.attribs;if(L.call(t.attribs,e))return!n&&Y.test(e)?e:t.attribs[e];if(t.name==="option"&&e==="value")return A(t.children);if(t.name==="input"&&(t.attribs.type==="radio"||t.attribs.type==="checkbox")&&e==="value")return"on"}}function S(t,e,n){n===null?_t(t,e):t.attribs[e]=`${n}`}function Xt(t,e){if(typeof t=="object"||e!==void 0){if(typeof e=="function"){if(typeof t!="string")throw new Error("Bad combination of arguments.");return h(this,(n,r)=>{u(n)&&S(n,t,e.call(n,r,n.attribs[t]))})}return h(this,n=>{u(n)&&(typeof t=="object"?Object.keys(t).forEach(r=>{let i=t[r];S(n,r,i)}):S(n,t,e))})}return arguments.length>1?this:R(this[0],t,this.options.xmlMode)}function gt(t,e,n){return e in t?t[e]:!n&&Y.test(e)?R(t,e,!1)!==void 0:R(t,e,n)}function J(t,e,n,r){e in t?t[e]=n:S(t,e,!r&&Y.test(e)?n?"":null:`${n}`)}function Vt(t,e){var n;if(typeof t=="string"&&e===void 0){let r=this[0];if(!r||!u(r))return;switch(t){case"style":{let i=this.css(),o=Object.keys(i);return o.forEach((s,c)=>{i[c]=s}),i.length=o.length,i}case"tagName":case"nodeName":return r.name.toUpperCase();case"href":case"src":{let i=(n=r.attribs)===null||n===void 0?void 0:n[t];return typeof URL<"u"&&(t==="href"&&(r.tagName==="a"||r.name==="link")||t==="src"&&(r.tagName==="img"||r.tagName==="iframe"||r.tagName==="audio"||r.tagName==="video"||r.tagName==="source"))&&i!==void 0&&this.options.baseURI?new URL(i,this.options.baseURI).href:i}case"innerText":return Gt(r);case"textContent":return Kt(r);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return gt(r,t,this.options.xmlMode)}}if(typeof t=="object"||e!==void 0){if(typeof e=="function"){if(typeof t=="object")throw new Error("Bad combination of arguments.");return h(this,(r,i)=>{u(r)&&J(r,t,e.call(r,i,gt(r,t,this.options.xmlMode)),this.options.xmlMode)})}return h(this,r=>{u(r)&&(typeof t=="object"?Object.keys(t).forEach(i=>{let o=t[i];J(r,i,o,this.options.xmlMode)}):J(r,t,e,this.options.xmlMode))})}}function yt(t,e,n){var r;let i=t;(r=i.data)!==null&&r!==void 0||(i.data={}),typeof e=="object"?Object.assign(i.data,e):typeof e=="string"&&n!==void 0&&(i.data[e]=n)}function bt(t,e){let n,r,i;e==null?(n=Object.keys(t.attribs).filter(o=>o.startsWith(H)),r=n.map(o=>dt(o.slice(H.length)))):(n=[H+mt(e)],r=[e]);for(let o=0;o<n.length;++o){let s=n[o],c=r[o];if(L.call(t.attribs,s)&&!L.call(t.data,c)){if(i=t.attribs[s],L.call(xt,i))i=xt[i];else if(i===String(Number(i)))i=Number(i);else if(Qt.test(i))try{i=JSON.parse(i)}catch{}t.data[c]=i}}return e==null?t.data:i}function te(t,e){var n;let r=this[0];if(!r||!u(r))return;let i=r;return(n=i.data)!==null&&n!==void 0||(i.data={}),t?typeof t=="object"||e!==void 0?(h(this,o=>{u(o)&&(typeof t=="object"?yt(o,t):yt(o,t,e))}),this):L.call(i.data,t)?i.data[t]:bt(i,t):bt(i)}function ee(t){let e=arguments.length===0,n=this[0];if(!n||!u(n))return e?void 0:this;switch(n.name){case"textarea":return this.text(t);case"select":{let r=this.find("option:selected");if(!e){if(this.attr("multiple")==null&&typeof t=="object")return this;this.find("option").removeAttr("selected");let i=typeof t!="object"?[t]:t;for(let o=0;o<i.length;o++)this.find(`option[value="${i[o]}"]`).attr("selected","");return this}return this.attr("multiple")?r.toArray().map(i=>A(i.children)):r.attr("value")}case"input":case"option":return e?this.attr("value"):this.attr("value",t)}}function _t(t,e){!t.attribs||!L.call(t.attribs,e)||delete t.attribs[e]}function B(t){return t?t.trim().split(C):[]}function ne(t){let e=B(t);for(let n=0;n<e.length;n++)h(this,r=>{u(r)&&_t(r,e[n])});return this}function re(t){return this.toArray().some(e=>{let n=u(e)&&e.attribs.class,r=-1;if(n&&t.length)for(;(r=n.indexOf(t,r+1))>-1;){let i=r+t.length;if((r===0||C.test(n[r-1]))&&(i===n.length||C.test(n[i])))return!0}return!1})}function At(t){if(typeof t=="function")return h(this,(r,i)=>{if(u(r)){let o=r.attribs.class||"";At.call([r],t.call(r,i,o))}});if(!t||typeof t!="string")return this;let e=t.split(C),n=this.length;for(let r=0;r<n;r++){let i=this[r];if(!u(i))continue;let o=R(i,"class",!1);if(!o)S(i,"class",e.join(" ").trim());else{let s=` ${o} `;for(let c=0;c<e.length;c++){let f=`${e[c]} `;s.includes(` ${f}`)||(s+=f)}S(i,"class",s.trim())}}return this}function vt(t){if(typeof t=="function")return h(this,(i,o)=>{u(i)&&vt.call([i],t.call(i,o,i.attribs.class||""))});let e=B(t),n=e.length,r=arguments.length===0;return h(this,i=>{if(u(i))if(r)i.attribs.class="";else{let o=B(i.attribs.class),s=!1;for(let c=0;c<n;c++){let f=o.indexOf(e[c]);f>=0&&(o.splice(f,1),s=!0,c--)}s&&(i.attribs.class=o.join(" "))}})}function kt(t,e){if(typeof t=="function")return h(this,(s,c)=>{u(s)&&kt.call([s],t.call(s,c,s.attribs.class||"",e),e)});if(!t||typeof t!="string")return this;let n=t.split(C),r=n.length,i=typeof e=="boolean"?e?1:-1:0,o=this.length;for(let s=0;s<o;s++){let c=this[s];if(!u(c))continue;let f=B(c.attribs.class);for(let p=0;p<r;p++){let l=f.indexOf(n[p]);i>=0&&l<0?f.push(n[p]):i<=0&&l>=0&&f.splice(l,1)}c.attribs.class=f.join(" ")}return this}var et={};O(et,{add:()=>Ne,addBack:()=>Pe,children:()=>_e,closest:()=>he,contents:()=>Ae,each:()=>ve,end:()=>Ce,eq:()=>Me,filter:()=>$e,filterArray:()=>tt,find:()=>fe,first:()=>Le,get:()=>Ee,has:()=>Oe,index:()=>Te,is:()=>we,last:()=>Se,map:()=>ke,next:()=>pe,nextAll:()=>de,nextUntil:()=>me,not:()=>je,parent:()=>ae,parents:()=>le,parentsUntil:()=>ue,prev:()=>xe,prevAll:()=>ge,prevUntil:()=>ye,siblings:()=>be,slice:()=>De,toArray:()=>Ue});import{hasChildren as ie,isDocument as K}from"domhandler";import*as b from"cheerio-select";import{getChildren as oe,getSiblings as se,nextElementSibling as $t,prevElementSibling as wt,uniqueSort as F}from"domutils";var ce=/^\s*[~+]/;function fe(t){var e;if(!t)return this._make([]);let n=this.toArray();if(typeof t!="string"){let o=g(t)?t.toArray():[t];return this._make(o.filter(s=>n.some(c=>Z(c,s))))}let r=ce.test(t)?n:this.children().toArray(),i={context:n,root:(e=this._root)===null||e===void 0?void 0:e[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(b.select(t,r,i))}function Q(t){return function(e,...n){return function(r){var i;let o=t(e,this);return r&&(o=tt(o,r,this.options.xmlMode,(i=this._root)===null||i===void 0?void 0:i[0])),this._make(this.length>1&&o.length>1?n.reduce((s,c)=>c(s),o):o)}}}var N=Q((t,e)=>{let n=[];for(let r=0;r<e.length;r++){let i=t(e[r]);n.push(i)}return new Array().concat(...n)}),X=Q((t,e)=>{let n=[];for(let r=0;r<e.length;r++){let i=t(e[r]);i!==null&&n.push(i)}return n});function V(t,...e){let n=null,r=Q((i,o)=>{let s=[];return h(o,c=>{for(let f;(f=i(c))&&!n?.(f,s.length);c=f)s.push(f)}),s})(t,...e);return function(i,o){n=typeof i=="string"?c=>b.is(c,i,this.options):i?P(i):null;let s=r.call(this,o);return n=null,s}}function M(t){return Array.from(new Set(t))}var ae=X(({parent:t})=>t&&!K(t)?t:null,M),le=N(t=>{let e=[];for(;t.parent&&!K(t.parent);)e.push(t.parent),t=t.parent;return e},F,t=>t.reverse()),ue=V(({parent:t})=>t&&!K(t)?t:null,F,t=>t.reverse());function he(t){var e;let n=[];if(!t)return this._make(n);let r={xmlMode:this.options.xmlMode,root:(e=this._root)===null||e===void 0?void 0:e[0]},i=typeof t=="string"?o=>b.is(o,t,r):P(t);return h(this,o=>{for(;o&&u(o);){if(i(o,0)){n.includes(o)||n.push(o);break}o=o.parent}}),this._make(n)}var pe=X(t=>$t(t)),de=N(t=>{let e=[];for(;t.next;)t=t.next,u(t)&&e.push(t);return e},M),me=V(t=>$t(t),M),xe=X(t=>wt(t)),ge=N(t=>{let e=[];for(;t.prev;)t=t.prev,u(t)&&e.push(t);return e},M),ye=V(t=>wt(t),M),be=N(t=>se(t).filter(e=>u(e)&&e!==t),F),_e=N(t=>oe(t).filter(u),M);function Ae(){let t=this.toArray().reduce((e,n)=>ie(n)?e.concat(n.children):e,[]);return this._make(t)}function ve(t){let e=0,n=this.length;for(;e<n&&t.call(this[e],e,this[e])!==!1;)++e;return this}function ke(t){let e=[];for(let n=0;n<this.length;n++){let r=this[n],i=t.call(r,n,r);i!=null&&(e=e.concat(i))}return this._make(e)}function P(t){return typeof t=="function"?(e,n)=>t.call(e,n,e):g(t)?e=>Array.prototype.includes.call(t,e):function(e){return t===e}}function $e(t){var e;return this._make(tt(this.toArray(),t,this.options.xmlMode,(e=this._root)===null||e===void 0?void 0:e[0]))}function tt(t,e,n,r){return typeof e=="string"?b.filter(e,t,{xmlMode:n,root:r}):t.filter(P(e))}function we(t){let e=this.toArray();return typeof t=="string"?b.some(e.filter(u),t,this.options):t?e.some(P(t)):!1}function je(t){let e=this.toArray();if(typeof t=="string"){let n=new Set(b.filter(t,e,this.options));e=e.filter(r=>!n.has(r))}else{let n=P(t);e=e.filter((r,i)=>!n(r,i))}return this._make(e)}function Oe(t){return this.filter(typeof t=="string"?`:has(${t})`:(e,n)=>this._make(n).find(t).length>0)}function Le(){return this.length>1?this._make(this[0]):this}function Se(){return this.length>0?this._make(this[this.length-1]):this}function Me(t){var e;return t=+t,t===0&&this.length<=1?this:(t<0&&(t=this.length+t),this._make((e=this[t])!==null&&e!==void 0?e:[]))}function Ee(t){return t==null?this.toArray():this[t<0?this.length+t:t]}function Ue(){return Array.prototype.slice.call(this)}function Te(t){let e,n;return t==null?(e=this.parent().children(),n=this[0]):typeof t=="string"?(e=this._make(t),n=this[0]):(e=this,n=g(t)?t[0]:t),Array.prototype.indexOf.call(e,n)}function De(t,e){return this._make(Array.prototype.slice.call(this,t,e))}function Ce(){var t;return(t=this.prevObject)!==null&&t!==void 0?t:this._make([])}function Ne(t,e){let n=this._make(t,e),r=F([...this.get(),...n.get()]);return this._make(r)}function Pe(t){return this.prevObject?this.add(t?this.prevObject.filter(t):this.prevObject):this}var nt={};O(nt,{_makeDomArray:()=>Fe,after:()=>Xe,append:()=>He,appendTo:()=>We,before:()=>tn,clone:()=>an,empty:()=>on,html:()=>sn,insertAfter:()=>Ve,insertBefore:()=>en,prepend:()=>Je,prependTo:()=>Ze,remove:()=>nn,replaceWith:()=>rn,text:()=>fn,toString:()=>cn,unwrap:()=>Ke,wrap:()=>Ye,wrapAll:()=>Qe,wrapInner:()=>Ge});import{Text as Re,hasChildren as _}from"domhandler";import{removeElement as Ie}from"domutils";import{Document as ze,isDocument as qe}from"domhandler";function jt(t){return function(n,r,i,o){if(typeof Buffer<"u"&&Buffer.isBuffer(n)&&(n=n.toString()),typeof n=="string")return t(n,r,i,o);let s=n;if(!Array.isArray(s)&&qe(s))return s;let c=new ze([]);return k(s,c),c}}function k(t,e){let n=Array.isArray(t)?t:[t];e?e.children=n:e=null;for(let r=0;r<n.length;r++){let i=n[r];i.parent&&i.parent.children!==n&&Ie(i),e?(i.prev=n[r-1]||null,i.next=n[r+1]||null):i.prev=i.next=null,i.parent=e}return e}import{removeElement as Be}from"domutils";function Fe(t,e){return t==null?[]:g(t)?e?q(t.get()):t.get():Array.isArray(t)?t.reduce((n,r)=>n.concat(this._makeDomArray(r,e)),[]):typeof t=="string"?this._parse(t,this.options,!1,null).children:e?q([t]):[t]}function Ot(t){return function(...e){let n=this.length-1;return h(this,(r,i)=>{if(!_(r))return;let o=typeof e[0]=="function"?e[0].call(r,i,this._render(r.children)):e,s=this._makeDomArray(o,i<n);t(s,r.children,r)})}}function $(t,e,n,r,i){var o,s;let c=[e,n,...r],f=e===0?null:t[e-1],p=e+n>=t.length?null:t[e+n];for(let l=0;l<r.length;++l){let a=r[l],d=a.parent;if(d){let m=d.children.indexOf(a);m>-1&&(d.children.splice(m,1),i===d&&e>m&&c[0]--)}a.parent=i,a.prev&&(a.prev.next=(o=a.next)!==null&&o!==void 0?o:null),a.next&&(a.next.prev=(s=a.prev)!==null&&s!==void 0?s:null),a.prev=l===0?f:r[l-1],a.next=l===r.length-1?p:r[l+1]}return f&&(f.next=r[0]),p&&(p.prev=r[r.length-1]),t.splice(...c)}function We(t){return(g(t)?t:this._make(t)).append(this),this}function Ze(t){return(g(t)?t:this._make(t)).prepend(this),this}var He=Ot((t,e,n)=>{$(e,e.length,0,t,n)}),Je=Ot((t,e,n)=>{$(e,0,0,t,n)});function Lt(t){return function(e){let n=this.length-1,r=this.parents().last();for(let i=0;i<this.length;i++){let o=this[i],s=typeof e=="function"?e.call(o,i,o):typeof e=="string"&&!D(e)?r.find(e).clone():e,[c]=this._makeDomArray(s,i<n);if(!c||!_(c))continue;let f=c,p=0;for(;p<f.children.length;){let l=f.children[p];u(l)?(f=l,p=0):p++}t(o,f,[c])}return this}}var Ye=Lt((t,e,n)=>{let{parent:r}=t;if(!r)return;let i=r.children,o=i.indexOf(t);k([t],e),$(i,o,0,n,r)}),Ge=Lt((t,e,n)=>{_(t)&&(k(t.children,e),k(n,t))});function Ke(t){return this.parent(t).not("body").each((e,n)=>{this._make(n).replaceWith(n.children)}),this}function Qe(t){let e=this[0];if(e){let n=this._make(typeof t=="function"?t.call(e,0,e):t).insertBefore(e),r;for(let o=0;o<n.length;o++)n[o].type==="tag"&&(r=n[o]);let i=0;for(;r&&i<r.children.length;){let o=r.children[i];o.type==="tag"?(r=o,i=0):i++}r&&this._make(r).append(this)}return this}function Xe(...t){let e=this.length-1;return h(this,(n,r)=>{let{parent:i}=n;if(!_(n)||!i)return;let o=i.children,s=o.indexOf(n);if(s<0)return;let c=typeof t[0]=="function"?t[0].call(n,r,this._render(n.children)):t,f=this._makeDomArray(c,r<e);$(o,s+1,0,f,i)})}function Ve(t){typeof t=="string"&&(t=this._make(t)),this.remove();let e=[];return this._makeDomArray(t).forEach(n=>{let r=this.clone().toArray(),{parent:i}=n;if(!i)return;let o=i.children,s=o.indexOf(n);s<0||($(o,s+1,0,r,i),e.push(...r))}),this._make(e)}function tn(...t){let e=this.length-1;return h(this,(n,r)=>{let{parent:i}=n;if(!_(n)||!i)return;let o=i.children,s=o.indexOf(n);if(s<0)return;let c=typeof t[0]=="function"?t[0].call(n,r,this._render(n.children)):t,f=this._makeDomArray(c,r<e);$(o,s,0,f,i)})}function en(t){let e=this._make(t);this.remove();let n=[];return h(e,r=>{let i=this.clone().toArray(),{parent:o}=r;if(!o)return;let s=o.children,c=s.indexOf(r);c<0||($(s,c,0,i,o),n.push(...i))}),this._make(n)}function nn(t){let e=t?this.filter(t):this;return h(e,n=>{Be(n),n.prev=n.next=n.parent=null}),this}function rn(t){return h(this,(e,n)=>{let{parent:r}=e;if(!r)return;let i=r.children,o=typeof t=="function"?t.call(e,n,e):t,s=this._makeDomArray(o);k(s,null);let c=i.indexOf(e);$(i,c,1,s,r),s.includes(e)||(e.parent=e.prev=e.next=null)})}function on(){return h(this,t=>{_(t)&&(t.children.forEach(e=>{e.next=e.prev=e.parent=null}),t.children.length=0)})}function sn(t){if(t===void 0){let e=this[0];return!e||!_(e)?null:this._render(e.children)}return h(this,e=>{if(!_(e))return;e.children.forEach(r=>{r.next=r.prev=r.parent=null});let n=g(t)?t.toArray():this._parse(`${t}`,this.options,!1,e).children;k(n,e)})}function cn(){return this._render(this)}function fn(t){return t===void 0?A(this):typeof t=="function"?h(this,(e,n)=>this._make(e).text(t.call(e,n,A([e])))):h(this,e=>{if(!_(e))return;e.children.forEach(r=>{r.next=r.prev=r.parent=null});let n=new Re(`${t}`);k(n,e)})}function an(){return this._make(q(this.get()))}var rt={};O(rt,{css:()=>ln});function ln(t,e){if(t!=null&&e!=null||typeof t=="object"&&!Array.isArray(t))return h(this,(n,r)=>{u(n)&&St(n,t,e,r)});if(this.length!==0)return Mt(this[0],t)}function St(t,e,n,r){if(typeof e=="string"){let i=Mt(t),o=typeof n=="function"?n.call(t,r,i[e]):n;o===""?delete i[e]:o!=null&&(i[e]=o),t.attribs.style=un(i)}else typeof e=="object"&&Object.keys(e).forEach((i,o)=>{St(t,i,e[i],o)})}function Mt(t,e){if(!t||!u(t))return;let n=hn(t.attribs.style);if(typeof e=="string")return n[e];if(Array.isArray(e)){let r={};return e.forEach(i=>{n[i]!=null&&(r[i]=n[i])}),r}return n}function un(t){return Object.keys(t).reduce((e,n)=>`${e}${e?" ":""}${n}: ${t[n]};`,"")}function hn(t){if(t=(t||"").trim(),!t)return{};let e={},n;for(let r of t.split(";")){let i=r.indexOf(":");if(i<1||i===r.length-1){let o=r.trimEnd();o.length>0&&n!==void 0&&(e[n]+=`;${o}`)}else n=r.slice(0,i).trim(),e[n]=r.slice(i+1).trim()}return e}var it={};O(it,{serialize:()=>dn,serializeArray:()=>mn});var Et="input,select,textarea,keygen",pn=/%20/g,Ut=/\r?\n/g;function dn(){return this.serializeArray().map(n=>`${encodeURIComponent(n.name)}=${encodeURIComponent(n.value)}`).join("&").replace(pn,"+")}function mn(){return this.map((t,e)=>{let n=this._make(e);return u(e)&&e.name==="form"?n.find(Et).toArray():n.filter(Et).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((t,e)=>{var n;let r=this._make(e),i=r.attr("name"),o=(n=r.val())!==null&&n!==void 0?n:"";return Array.isArray(o)?o.map(s=>({name:i,value:s.replace(Ut,`\r
`)})):{name:i,value:o.replace(Ut,`\r
`)}}).toArray()}var w=class{constructor(e,n,r){if(this.length=0,this.options=r,this._root=n,e){for(let i=0;i<e.length;i++)this[i]=e[i];this.length=e.length}}};w.prototype.cheerio="[cheerio object]";w.prototype.splice=Array.prototype.splice;w.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(w.prototype,G,et,nt,rt,it);function Tt(t,e){return function n(r,i,o=!0){if(r==null)throw new Error("cheerio.load() expects a string");let s={...U,...T(i)},c=t(r,s,o,null);class f extends w{_make(a,d){let x=p(a,d);return x.prevObject=this,x}_parse(a,d,x,m){return t(a,d,x,m)}_render(a){return e(a,this.options)}}function p(l,a,d=c,x){if(l&&g(l))return l;let m={...s,...T(x)},E=typeof d=="string"?[t(d,m,!1,null)]:"length"in d?d:[d],y=g(E)?E:new f(E,null,m);if(y._root=y,!l)return new f(void 0,y,m);let z=typeof l=="string"&&D(l)?t(l,m,!1,null).children:xn(l)?[l]:Array.isArray(l)?l:void 0,st=new f(z,y,m);if(z)return st;if(typeof l!="string")throw new Error("Unexpected type of selector");let W=l,ct=a?typeof a=="string"?D(a)?new f([t(a,m,!1,null)],y,m):(W=`${a} ${W}`,y):g(a)?a:new f(Array.isArray(a)?a:[a],y,m):y;return ct?ct.find(W):st}return Object.assign(p,v,{load:n,_root:c,_options:s,fn:f.prototype,prototype:f.prototype}),p}}function xn(t){return!!t.name||t.type==="root"||t.type==="text"||t.type==="comment"}import{isDocument as gn}from"domhandler";import{parse as yn,parseFragment as bn,serializeOuter as _n}from"parse5";import{adapter as Dt}from"parse5-htmlparser2-tree-adapter";function Ct(t,e,n,r){let i={scriptingEnabled:typeof e.scriptingEnabled=="boolean"?e.scriptingEnabled:!0,treeAdapter:Dt,sourceCodeLocationInfo:e.sourceCodeLocationInfo};return n?yn(t,i):bn(r,t,i)}var An={treeAdapter:Dt};function Nt(t){let e="length"in t?t:[t];for(let r=0;r<e.length;r+=1){let i=e[r];gn(i)&&Array.prototype.splice.call(e,r,1,...i.children)}let n="";for(let r=0;r<e.length;r+=1){let i=e[r];n+=_n(i,An)}return n}import vn from"dom-serializer";import{parseDocument as kn}from"htmlparser2";var $n=jt((t,e,n,r)=>e.xmlMode||e._useHtmlParser2?kn(t,e):Ct(t,e,n,r)),wn=Tt($n,(t,e)=>e.xmlMode||e._useHtmlParser2?vn(t,e):Nt(t)),I=wn([]),{contains:xr}=v,{merge:gr}=v,{parseHTML:yr}=v,{root:br}=v;var Pt=It.join(jn.tmpdir(),"upmovies.tmp"),Sn=It.basename(Ln.fileURLToPath(import.meta.url)),qt=process.argv.slice(2).join("+");qt||(console.log(`Usage: ${Sn} <search term>`),process.exit(1));var Mn=async()=>{let e=await fetch("https://upmovies.net/search-movies/"+qt+".html").then(o=>o.text()).then(o=>I.load(o)),n=e(".itemInfo");n.length===0&&(console.log("[info] Nothing found, try another search term"),process.exit(0));let r="";return n.each((o,s)=>{let c=e(s).find(".title > a").attr("href"),f=e(s).find(".title > a").text().replace(/ /g,"_"),p=e(s).find(".file-info :nth-child(5)").text().split(":")[1].trim();r+=`[${p}] ${f} ${c}
`}),r=r.replace(/\n$/,""),ot(`echo "${r}" | fzf --cycle --with-nth 1,2 | cut -d' ' -f3`,{stdio:["inherit","pipe","inherit"],shell:!0,encoding:"utf-8"}).stdout.replace(/\n$/,"")};async function En(){let t=await Mn();t||process.exit(1);let e=[],n=t.includes("season");n?await fetch(t).then(o=>o.text()).then(o=>{let s=I.load(o);s("a.episode_series_link").each((c,f)=>{let p=s(f).attr("href");e.push(p)})}):e.push(t);function r(o){return Number(o)<10?"0"+o:o}let i=[];for(let o of e)await fetch(o).then(s=>s.text()).then(s=>{let c=I.load(s),f=Buffer.from(c(".player-iframe").text().match(/".*"/)[0],"base64"),l=I.load(f)("iframe").attr("src"),a=c(".about > .features > ul > li:nth-child(5)").text().split(":")[1].trim();if(n){let d=o.includes(a)?"":`${a}`,x=o.split("/"),m=x[4].split("-").slice(1,-2).join("_"),E=x[4].split("-").at(-1),y=x[5].split("-")[1].replace(".html",""),z=`"${l}" -o "${m}_${d}_S${r(E)}E${r(y)}.mp4"`;i.push(z)}else{let d=o.split("/")[4].split("-").slice(1).join("_").replace(".html",""),x=d.includes(a)?"":`_${a}`;ot(`yt-dlp "${l}" -o "${d}${x}.mp4"`,{stdio:["inherit","inherit","inherit"],shell:!0,encoding:"utf-8"})}});if(n){On.writeFileSync(Pt,i.join(`
`));let o=i[0].match(/S([0-9]{2})E/)[1];console.log(`[info] there are ${i.length} episodes in season ${o.replace(/^0/,"")}`),console.log(`[info] Use 'sed' like selection to choose what episodes to download (eg. "1p;5p;10,22p" to download episodes 1 5 and 10-22)`);let s=zt.createInterface({input:process.stdin,output:process.stdout}),c=`1,${i.length}p`,p=await s.question("[????] (press enter to choose all) > ");s.close(),p&&(c=p),ot(`sed -n "${c}" ${Pt} | xargs -tl yt-dlp`,{stdio:["inherit","inherit","inherit"],shell:!0,encoding:"utf-8"})}}En().catch(t=>{console.log(t),process.exit(1)});
